var grayscale=function(){var e={colorProps:["color","backgroundColor","borderBottomColor","borderTopColor","borderLeftColor","borderRightColor","backgroundImage"],externalImageHandler:{init:function(e,t){"img"===e.nodeName.toLowerCase()||(a(e).backgroundImageSRC=t,e.style.backgroundImage="")},reset:function(e){"img"===e.nodeName.toLowerCase()||(e.style.backgroundImage="url("+(a(e).backgroundImageSRC||"")+")")}}},t=function(e){return new RegExp("https?://(?!"+window.location.hostname+")").test(e)},a=function(){var e=[0],t="data"+ +new Date;return function(a){var r=a[t],n=e.length;return r||(r=a[t]=n,e[r]={}),e[r]}}(),r=function(e,t,n){var l,i=document.createElement("canvas"),c=i.getContext("2d"),g=e.naturalHeight||e.offsetHeight||e.height,d=e.naturalWidth||e.offsetWidth||e.width;i.height=g,i.width=d,c.drawImage(e,0,0);try{l=c.getImageData(0,0,d,g)}catch(e){}if(!t){r.preparing=!1;for(u=0;u<g;u++)for(var s=0;s<d;s++){var m=4*(u*d+s);l.data[m]=l.data[m+1]=l.data[m+2]=o(l.data[m],l.data[m+1],l.data[m+2])}return c.putImageData(l,0,0,0,0,d,g),i}r.preparing=!0;var u=0;!function(){if(r.preparing){u===g&&(c.putImageData(l,0,0,0,0,d,g),n?a(n).BGdataURL=i.toDataURL():a(e).dataURL=i.toDataURL());for(var t=0;t<d;t++){var s=4*(u*d+t);l.data[s]=l.data[s+1]=l.data[s+2]=o(l.data[s],l.data[s+1],l.data[s+2])}u++,setTimeout(arguments.callee,0)}}()},n=function(e,t){var a=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null)[t]:e.currentStyle[t];if(a&&/^#[A-F0-9]/i.test(a)){var r=a.match(/[A-F0-9]{2}/gi);a="rgb("+parseInt(r[0],16)+","+parseInt(r[1],16)+","+parseInt(r[2],16)+")"}return a},o=function(e,t,a){return parseInt(.2125*e+.7154*t+.0721*a,10)},l=function(e){var t=Array.prototype.slice.call(e.getElementsByTagName("*"));return t.unshift(e),t},i=function(c){if(c&&c[0]&&c.length&&c[0].nodeName)for(var g=Array.prototype.slice.call(c),d=-1,s=g.length;++d<s;)i.call(this,g[d]);else{if(c=c||document.documentElement,!document.createElement("canvas").getContext)return c.style.filter="progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)",void(c.style.zoom=1);for(var m=l(c),u=-1,f=m.length;++u<f;){var p=m[u];if("img"===p.nodeName.toLowerCase()){var v=p.getAttribute("src");if(!v)continue;if(t(v))e.externalImageHandler.init(p,v);else{a(p).realSRC=v;try{p.src=a(p).dataURL||r(p).toDataURL()}catch(t){e.externalImageHandler.init(p,v)}}}else for(var h=0,y=e.colorProps.length;h<y;h++){var I=e.colorProps[h],C=n(p,I);if(C)if(p.style[I]&&(a(p)[I]=C),"rgb("!==C.substring(0,4)){if(C.indexOf("url(")>-1){var b=/\(['"]?(.+?)['"]?\)/,x=C.match(b)[1];if(t(x)){e.externalImageHandler.init(p,x),a(p).externalBG=!0;continue}try{var w=a(p).BGdataURL||function(){var e=document.createElement("img");return e.src=x,r(e).toDataURL()}();p.style[I]=C.replace(b,function(e,t){return"("+w+")"})}catch(t){e.externalImageHandler.init(p,x)}}}else{var L=o.apply(null,C.match(/\d+/g));p.style[I]=C="rgb("+L+","+L+","+L+")"}}}}};return i.reset=function(r){if(r&&r[0]&&r.length&&r[0].nodeName)for(var n=Array.prototype.slice.call(r),o=-1,c=n.length;++o<c;)i.reset.call(this,n[o]);else if(r=r||document.documentElement,document.createElement("canvas").getContext)for(var g=l(r),d=-1,s=g.length;++d<s;){var m=g[d];if("img"===m.nodeName.toLowerCase()){var u=m.getAttribute("src");t(u)&&e.externalImageHandler.reset(m,u),m.src=a(m).realSRC||u}else for(var f=0,p=e.colorProps.length;f<p;f++){a(m).externalBG&&e.externalImageHandler.reset(m);var v=e.colorProps[f];m.style[v]=a(m)[v]||""}}else r.style.filter="progid:DXImageTransform.Microsoft.BasicImage(grayscale=0)"},i.prepare=function(e){if(e&&e[0]&&e.length&&e[0].nodeName)for(var o=Array.prototype.slice.call(e),c=-1,g=o.length;++c<g;)i.prepare.call(null,o[c]);else if(e=e||document.documentElement,document.createElement("canvas").getContext)for(var d=l(e),s=-1,m=d.length;++s<m;){var u=d[s];if(a(u).skip)return;if("img"===u.nodeName.toLowerCase())u.getAttribute("src")&&!t(u.src)&&r(u,!0);else{var f=n(u,"backgroundImage");if(f.indexOf("url(")>-1){var p=f.match(/\(['"]?(.+?)['"]?\)/)[1];if(!t(p)){var v=document.createElement("img");v.src=p,r(v,!0,u)}}}}},i}();